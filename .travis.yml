language: objective-c
osx_image: xcode8
xcode_workspace: Keymochi.xcworkspace
xcode_scheme: Keymochi
xcode_sdk: iphonesimulator10.0
before_install:
- openssl aes-256-cbc -K $encrypted_fd1124c3ecb8_key -iv $encrypted_fd1124c3ecb8_iv -in git-crypt.key.enc -out git-crypt.key -d
- brew update && brew install git-crypt
- git-crypt unlock git-crypt.key

install:
- gem install xcpretty --no-rdoc --no-ri --no-document --quiet
- gem install xcpretty-travis-formatter --no-rdoc --no-ri --no-document --quiet

script:
- set -o pipefail && xcodebuild -workspace ${WORKSPACE} -scheme ${SCHEME} -sdk ${SDK} -destination ${DESTINATION} dONLY_ACTIVE_ARCH=NO clean build | xcpretty -f `xcpretty-travis-formatter` || true
- set -o pipefail && xcodebuild -workspace ${WORKSPACE} -scheme ${SCHEME} -sdk ${SDK} -destination ${DESTINATION} dONLY_ACTIVE_ARCH=NO test | xcpretty -f `xcpretty-travis-formatter`

env:
  global:
  - WORKSPACE="Keymochi.xcworkspace"
  - SCHEME="Keymochi"
  - SDK="iphonesimulator10.0"
  - DESTINATION="platform='iOS Simulator',OS=10.0,name='iPhone 7'"

